<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<title>填写密码</title>
		<link rel="stylesheet" href="../ytfui/css/ytfui.css" />
		<link rel="stylesheet" href="../css/main.css" />
		<script src="../ytfui/js/html-size-calculation.js" type="text/javascript" charset="utf-8"></script>
	</head>

	<body>
		<ul class="plr30 lgrlist mt30">
			<li class="yt bb yt-ac">
				<i class="dx-icon-lock"></i>
				<div class="yt-f1  dx-psw">
					<input type="password" id="pwd" class="input-text bgn bn" placeholder="输入密码">
					<div class="input-psw">
						显示密码
					</div>
				</div>
				<div class="dx-icon-eye"></div>
			</li>
			<li class="yt bb yt-ac">
				<i class="dx-icon-lock"></i>
				<div class="yt-f1 dx-psw">
					<input type="password" id="rpwd" class="input-text bgn bn" placeholder="输入密码">
					<div class="input-psw">
						再次输入密码
					</div>
				</div>
				<div class="dx-icon-eye"></div>
			</li>
		</ul>

		<div class="btn btn-b bg-second yt-f1 db ml30 mr30 mt120 fz36">
			确认并登录
		</div>
	</body>
	<script src="../script/zepto.min.js" type="text/javascript"></script>
	<script src="../script/common.js" type="text/javascript"></script>
	<script src="../ytfui/js/html-size-calculation.js" type="text/javascript" charset="utf-8"></script>
	<script>
		var proof = "",
		    type = "";
		ytfready = function() {
			var param = YTF.htmlParam;
			type = param.type;
			proof = param.proof;
		}
		/**
		 *确认
		 */
		$(".bg-second").bind("tap", function() {
			var pwd = $("#pwd").val().trim();
			var rpwd = $("#rpwd").val().trim();
			if (checkIsEmpty(pwd)) {
				YTF.toast({
					msg : '请输入密码！'
				});
			} else if (checkIsEmpty(rpwd)) {
				YTF.toast({
					msg : '请输入确认密码！'
				});
			} else if (pwd != rpwd) {
				YTF.toast({
					msg : '密码不一致！'
				});
			} else {
				switch(type) {
				case 1:
					registerUser(pwd);
					break;
				case 2:
					login(pwd);
					break;
				}
			}
		});

		/**
		 * 登录
		 */
		function login(pwd) {
			YTF.showProgress({
				bottomText : "提交中...",
				gifSize : {
					w : 60,
					h : 60
				},
				xywh : {
					w : 130,
					h : 130
				}
			});
			YTF.ajax({
				url : serverUrl + 'app/login/find-pwd',
				methodType : 'post',
				isReport : false,
				data : {
					values : {
						proof : proof,
						password : pwd
					}
				}
			}, function(ret, err) {
				YTF.hideProgress();
				if (ret) {
					if (ret.status == 1) {
						openLoginWin("login_win", "./login_win.html");
					} else {
						YTF.toast({
							msg : ret.msg
						});
					}
				} else {
					YTF.toast({
						msg : err.msg
					});
				}
			});
		};

		/**
		 *注册
		 */
		function registerUser(pwd) {
			YTF.showProgress({
				bottomText : "加载中...",
				gifSize : {
					w : 60,
					h : 60
				},
				xywh : {
					w : 130,
					h : 130
				}
			});
			YTF.ajax({
				url : serverUrl + 'app/login/reg',
				methodType : 'post',
				isReport : false,
				data : {
					values : {
						proof : proof,
						password : pwd
					}
				}
			}, function(ret, err) {
				YTF.hideProgress();
				if (ret) {
					if (ret.status == 1) {
						localStorage.setItem('logtoken', ret.data.logtoken);
						localStorage.setItem('postcode', ret.data.postcode);
						YTF.winOpen({
							winName : 'register_succ_win',
							htmlUrl : './register_succ_win.html',
							htmlParam : {
								tip : ret.data.integral_msg
							}
						});
					} else {
						YTF.toast({
							msg : ret.msg
						});
					}
				} else {
					YTF.toast({
						msg : err.msg
					});
				}
			});
		};

	</script>
</html>